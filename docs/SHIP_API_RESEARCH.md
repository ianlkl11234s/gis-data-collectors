# 航運資料 API 研究報告

**研究日期**: 2026-02-03
**研究目的**: 評估台灣航運資料來源，建立船舶軌跡收集系統

---

## 一、資料來源總覽

| 來源 | 資料類型 | 船舶涵蓋 | 更新頻率 | API 可用性 |
|-----|---------|---------|---------|-----------|
| **航港局 AIS** | 即時船位 | 全船型 ~7,000+ | 60 秒 | 可用 (非官方) |
| **TDX Ship** | 國內航線 | 客輪 ~5 艘 | 60 秒 | 可用 (官方) |
| **TDX Route** | 航線靜態 | 36 條航線 | 每日 | 可用 (官方) |
| **TDX Port** | 港口資料 | 73 個港口 | 靜態 | 可用 (官方) |

---

## 二、航港局 AIS 系統

### 2.1 系統資訊

- **網址**: https://mpbais.motcmpb.gov.tw/aismpb/
- **主管機關**: 交通部航港局
- **資料來源**: 岸基 AIS 接收站

### 2.2 API 端點

| 端點 | 用途 | 狀態 |
|-----|------|------|
| `geojsonais.ashx` | 即時船位 | **可用** |
| `geojsontrack.ashx` | 船舶軌跡 | 需授權 |
| `geoJsonAISSnapshot.ashx` | 歷史快照 | 需授權 |

### 2.3 即時 AIS 資料結構 (geojsonais.ashx)

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [121.5, 25.0]
      },
      "properties": {
        "MMSI": "416123456",
        "IMO_Number": "9123456",
        "ShipName": "EVER GIVEN",
        "Call_Sign": "BXYZ",
        "Ship_and_Cargo_Type": 70,
        "Navigational_Status": 0,
        "SOG": 12.5,
        "COG": 180.0,
        "True_Heading": 179,
        "Rate_of_Turn": 0,
        "Overall_Length": 400,
        "Breadth": 59,
        "Draught": 14.5,
        "Destination": "KAOHSIUNG",
        "ETA": "0215 1200",
        "Record_Time": "2026-02-03T22:30:00"
      }
    }
  ]
}
```

### 2.4 資料統計 (實測)

**測試時間**: 2026-02-03 22:36

| 統計項目 | 數值 |
|---------|------|
| 總船舶數 | 7,323 艘 |
| 台灣籍船舶 | 1,243 艘 |
| 漁船 | 1,964 艘 |
| 貨船 | 993 艘 |
| 油輪 | 252 艘 |
| 客輪 | 52 艘 |

### 2.5 三種 API 端點差異

| 端點 | 即時 AIS | 船舶軌跡 | 歷史快照 |
|-----|---------|---------|---------|
| **檔案** | geojsonais.ashx | geojsontrack.ashx | geoJsonAISSnapshot.ashx |
| **用途** | 當下所有船位 | 單船歷史軌跡 | 特定時間點快照 |
| **參數** | 無 | mmsi, 時間範圍 | 時間戳記 |
| **外部存取** | 可 | 不可 | 不可 |
| **適合場景** | 即時監控、軌跡累積 | 航跡回放 | 時光機功能 |

**結論**: 只有「即時 AIS」可從外部存取，需自行累積資料來建立歷史軌跡。

---

## 三、TDX 航運 API

### 3.1 可用端點

| 端點 | 說明 | 資料量 |
|-----|------|-------|
| `/v3/Ship/Route` | 所有航線 | 36 條 |
| `/v3/Ship/Port` | 所有港口 | 73 個 |
| `/v3/Ship/StopOfRoute` | 航線停靠站 | - |
| `/v3/Ship/LivePosition` | 即時船位 | 0~5 艘 |
| `/v3/Ship/DailySchedule/Domestic/City/{City}` | 每日時刻表 | 按縣市 |
| `/v3/Ship/GeneralSchedule/Domestic/City/{City}` | 一般時刻表 | 按縣市 |

### 3.2 航線統計

| 航線類型 | 總數 | 營運中 |
|---------|------|--------|
| 國內航線 | 24 條 | 13 條 |
| 兩岸航線 (小三通) | 7 條 | 4 條 |
| 國際航線 | 4 條 | 0 條 |
| **總計** | **36 條** | **17 條** |

### 3.3 主要國內航線

#### 小琉球航線
- 東港-小琉球 (營運中)
- 鹽埔-小琉球 (營運中)

#### 澎湖航線
- 高雄-馬公 (營運中)
- 布袋-馬公 (冬季停航)
- 馬公-望安-七美 (營運中)
- 馬公-吉貝 (營運中)

#### 台東離島
- 台東富岡-綠島 (冬季減班)
- 台東富岡-蘭嶼 (冬季減班)

#### 馬祖航線
- 基隆-南竿-東引 (營運中)
- 南竿-北竿 (營運中)
- 東莒-西莒 (營運中)

#### 金門航線 (小三通)
- 金門水頭-廈門五通 (營運中)
- 金門-泉州石井 (營運中)

### 3.4 TDX LivePosition 限制

實測發現 TDX 的即時船位資料量極少 (0~5 艘)，主要追蹤國內客輪。
若要取得完整船舶動態，應使用航港局 AIS 系統。

---

## 四、資料收集策略

### 4.1 建議方案

| 資料類型 | 來源 | 頻率 | 用途 |
|---------|------|------|------|
| 即時船位 | 航港局 AIS | 2 分鐘 | 軌跡累積、熱度圖 |
| 國內航線船位 | TDX | 2 分鐘 | 客輪追蹤 (備援) |
| 航線資料 | TDX | 每日 | 基礎資料 |
| 港口資料 | TDX | 靜態 | 基礎資料 |

### 4.2 資料量估算

**航港局 AIS (每 2 分鐘)**:
- 每次: ~7,000 筆
- 每小時: ~210,000 筆
- 每日: ~5,040,000 筆
- 每日儲存: ~200-400 MB (JSON, 壓縮後 ~50 MB)

**S3 成本估算**:
- 月儲存: ~1.5 GB (壓縮後)
- 成本: ~$0.03/月 (S3 Standard)

### 4.3 熱度圖建議

1. **資料累積**: 每 2 分鐘收集即時船位
2. **空間聚合**: 使用 H3 六角格網 (resolution 7-8)
3. **時間聚合**: 每小時/每日產生熱度統計
4. **視覺化**: Kepler.gl 或 Deck.gl 渲染

---

## 五、AIS 欄位說明

### 5.1 船舶類型代碼 (Ship_and_Cargo_Type)

| 代碼 | 類型 |
|-----|------|
| 0 | 未指定 |
| 30 | 漁船 |
| 31-35 | 拖船、疏浚船、軍艦等 |
| 36-37 | 帆船、遊艇 |
| 40 | 高速船 |
| 50-55 | 引水船、搜救船、執法船 |
| 60-69 | 客輪 |
| 70-79 | 貨船 |
| 80-89 | 油輪 |
| 90+ | 其他 |

### 5.2 航行狀態代碼 (Navigational_Status)

| 代碼 | 狀態 |
|-----|------|
| 0 | 航行中 (使用引擎) |
| 1 | 錨泊中 |
| 2 | 失去控制 |
| 3 | 操縱能力受限 |
| 4 | 受吃水限制 |
| 5 | 繫泊中 |
| 6 | 擱淺 |
| 7 | 從事捕魚 |
| 8 | 帆船航行 |
| 15 | 未定義 |

### 5.3 MMSI 編碼規則

MMSI (Maritime Mobile Service Identity) 前三碼為 MID (Maritime Identification Digits)，代表船旗國：

| MID | 國家/地區 |
|-----|---------|
| 416 | 台灣 |
| 412-414 | 中國 |
| 431-432 | 日本 |
| 440-441 | 韓國 |
| 351-374 | 巴拿馬 |
| 636-637 | 賴比瑞亞 |
| 477 | 香港 |
| 563-566 | 新加坡 |

---

## 六、已建立的收集器

### 6.1 ShipAISCollector

**檔案**: `collectors/ship_ais.py`

- 資料來源: 航港局 AIS
- 更新頻率: 每 2 分鐘
- 輸出: `ship_ais/{YYYY}/{MM}/{DD}/ship_ais_{HHMM}.json`

### 6.2 ShipTDXCollector

**檔案**: `collectors/ship_tdx.py`

- 資料來源: TDX Ship/LivePosition
- 更新頻率: 每 2 分鐘
- 輸出: `ship_tdx/{YYYY}/{MM}/{DD}/ship_tdx_{HHMM}.json`

### 6.3 設定參數

```bash
# 環境變數
SHIP_TDX_ENABLED=true      # 啟用 TDX 收集器
SHIP_TDX_INTERVAL=2        # TDX 更新間隔 (分鐘)
SHIP_AIS_ENABLED=true      # 啟用 AIS 收集器
SHIP_AIS_INTERVAL=2        # AIS 更新間隔 (分鐘)
```

---

## 七、後續應用

### 7.1 即時船位地圖

- 顯示台灣周邊所有船舶位置
- 依船型、船旗國分類
- 點擊顯示船舶詳情

### 7.2 歷史軌跡熱度圖

- 累積一週資料後產生
- H3 格網聚合
- 識別主要航道

### 7.3 港口進出分析

- 定義港口邊界
- 統計進出船次
- 計算平均停留時間

### 7.4 離島交通監控

- 追蹤國內客輪
- 即時顯示航班狀態
- 整合時刻表資料

---

## 八、參考資源

- [TDX 運輸資料流通服務](https://tdx.transportdata.tw/)
- [臺灣海域船舶即時資訊系統](https://mpbais.motcmpb.gov.tw/aismpb/)
- [AIS 自動識別系統 - 維基百科](https://zh.wikipedia.org/wiki/自動識別系統)
- [MarineTraffic](https://www.marinetraffic.com/)
